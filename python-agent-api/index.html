<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://fixie.ai/python-agent-api/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Python Agent API - Fixie Developer Portal</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../css/custom.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Python Agent API";
        var mkdocs_page_input_path = "python-agent-api.md";
        var mkdocs_page_url = "/python-agent-api/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script>
<script
async
src="https://www.googletagmanager.com/gtag/js?id=G-T4VHHYL14W"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());
  
  gtag("config", "G-T4VHHYL14W");
  </script>
<script>
(function(apiKey){
    (function(p,e,n,d,o){var v,w,x,y,z;o=p[d]=p[d]||{};o._q=o._q||[];
    v=['initialize','identify','updateOptions','pageLoad','track'];for(w=0,x=v.length;w<x;++w)(function(m){
        o[m]=o[m]||function(){o._q[m===v[0]?'unshift':'push']([m].concat([].slice.call(arguments,0)));};})(v[w]);
        y=e.createElement(n);y.async=!0;y.src='https://cdn.pendo.io/agent/static/'+apiKey+'/pendo.js';
        z=e.getElementsByTagName(n)[0];z.parentNode.insertBefore(y,z);})(window,document,'script','pendo');
})('6180bd3c-4b13-420f-6928-e46f13dabb77');
</script>
<script type="text/javascript">
  (function(f,b){if(!b.__SV){var e,g,i,h;window.mixpanel=b;b._i=[];b.init=function(e,f,c){function g(a,d){var b=d.split(".");2==b.length&&(a=a[b[0]],d=b[1]);a[d]=function(){a.push([d].concat(Array.prototype.slice.call(arguments,0)))}}var a=b;"undefined"!==typeof c?a=b[c]=[]:c="mixpanel";a.people=a.people||[];a.toString=function(a){var d="mixpanel";"mixpanel"!==c&&(d+="."+c);a||(d+=" (stub)");return d};a.people.toString=function(){return a.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms track_with_groups add_group set_group remove_group register register_once alias unregister identify name_tag set_config reset opt_in_tracking opt_out_tracking has_opted_in_tracking has_opted_out_tracking clear_opt_in_out_tracking start_batch_senders people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user people.remove".split(" ");
  for(h=0;h<i.length;h++)g(a,i[h]);var j="set set_once union unset remove delete".split(" ");a.get_group=function(){function b(c){d[c]=function(){call2_args=arguments;call2=[c].concat(Array.prototype.slice.call(call2_args,0));a.push([e,call2])}}for(var d={},e=["get_group"].concat(Array.prototype.slice.call(arguments,0)),c=0;c<j.length;c++)b(j[c]);return d};b._i.push([e,f,c])};b.__SV=1.2;e=f.createElement("script");e.type="text/javascript";e.async=!0;e.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?
  MIXPANEL_CUSTOM_LIB_URL:"file:"===f.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";g=f.getElementsByTagName("script")[0];g.parentNode.insertBefore(e,g)}})(document,window.mixpanel||[]);
  </script>
<script type="text/javascript">
  window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src="https://cdn.heapanalytics.com/js/heap-"+e+".js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(r,a);for(var n=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","resetIdentity","removeEventProperty","setEventProperties","track","unsetEventProperty"],o=0;o<p.length;o++)heap[p[o]]=n(p[o])};
  heap.load("2470912105");
</script>

<script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/24456200.js"></script>

<script>
  (function(h,o,u,n,d) {
     h=h[d]=h[d]||{q:[],onReady:function(c){h.q.push(c)}}
     d=o.createElement(u);d.async=1;d.src=n
     n=o.getElementsByTagName(u)[0];n.parentNode.insertBefore(d,n)
  })(window,document,'script','https://www.datadoghq-browser-agent.com/us1/v4/datadog-rum.js','DD_RUM')
  window.DD_RUM.onReady(function() {
    window.DD_RUM.init({
      applicationId: 'c3ef95f4-ab34-4aff-9f26-ed6bb5734d7b',
      clientToken: 'pub2e9329101f46c60b6b7bed60bf7c5888',
      site: 'datadoghq.com',
      service: 'fixie---web',
      env: 'docs',
      version: 'docs',
      sessionSampleRate: 100,
      sessionReplaySampleRate: 20,
      trackUserInteractions: true,
      trackResources: true,
      trackLongTasks: true,
      defaultPrivacyLevel: 'mask-user-input',
    })
  })
</script>

<script>
mixpanel.init('d695f343799edd2d62beb38eea46b4fc', { debug: true });
window.pendo.initialize();
</script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="..">
          <img src="../assets/fixie-logo-docs.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../architecture/">Architecture</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Building Fixie Agents</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../agent-quickstart/">Agent QuickStart</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../agents/">Fixie Agent API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../agent-protocol/">Agent Protocol</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Common Use Cases</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../document-qa/">Document Question and Answering</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../langchain/">Using Langchain</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Python SDK</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../python-client-api/">Python Client API</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Python Agent API</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.api">fixieai.agents.api</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.api.AgentError">AgentError</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.api.AgentQuery">AgentQuery</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.api.AgentResponse">AgentResponse</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.api.Embed">Embed</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fixieai.agents.api.Embed.content">content</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fixieai.agents.api.Embed.text">text</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.api.Message">Message</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.code_shot">fixieai.agents.code_shot</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.code_shot.CodeShotAgent">CodeShotAgent</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.corpora">fixieai.agents.corpora</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.corpora.CorpusDocument">CorpusDocument</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.corpora.CorpusPage">CorpusPage</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.corpora.CorpusPartition">CorpusPartition</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.corpora.CorpusRequest">CorpusRequest</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.corpora.CorpusResponse">CorpusResponse</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.corpora.CustomCorpus">CustomCorpus</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.corpora.DocumentLoader">DocumentLoader</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.corpora.UrlDocumentCorpus">UrlDocumentCorpus</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fixieai.agents.corpora.UrlDocumentCorpus.exclude_patterns">exclude_patterns</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fixieai.agents.corpora.UrlDocumentCorpus.urls">urls</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.oauth">fixieai.agents.oauth</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.oauth.OAuthHandler">OAuthHandler</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fixieai.agents.oauth.OAuthHandler.authorize">authorize()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fixieai.agents.oauth.OAuthHandler.get_authorization_url">get_authorization_url()</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fixieai.agents.oauth.OAuthHandler.user_token">user_token()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.oauth.OAuthParams">OAuthParams</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fixieai.agents.oauth.OAuthParams.from_client_secrets_file">from_client_secrets_file()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.standalone">fixieai.agents.standalone</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.standalone.StandaloneAgent">StandaloneAgent</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.user_storage">fixieai.agents.user_storage</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.user_storage.UserStorage">UserStorage</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.user_storage.from_json">from_json()</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.user_storage.from_json_type">from_json_type()</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.user_storage.to_json">to_json()</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.user_storage.to_json_type">to_json_type()</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.utils">fixieai.agents.utils</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.utils.FewshotLinePattern">FewshotLinePattern</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fixieai.agents.utils.FewshotLinePattern.match">match()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.utils.strip_prompt_lines">strip_prompt_lines()</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#fixieai.agents.utils.validate_code_shot_agent">validate_code_shot_agent()</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Command line interface</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../cli/">CLI</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">GraphQL API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="https://app.fixie.ai/static/docs/index.html">GraphQL</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Other links</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="https://github.com/fixie-ai/fixie-sdk">GitHub</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://discord.gg/MsKAeKF8kU">Discord</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://twitter.com/fixieai">Twitter</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Fixie Developer Portal</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>Python SDK &raquo;</li>
      <li>Python Agent API</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="fixie-agent-python-api-reference">Fixie Agent Python API Reference</h1>


<div class="doc doc-object doc-module">


<a id="fixieai.agents.api"></a>
  <div class="doc doc-contents first">
  
      <p>This module holds objects that represent the API interface by which Agents talk to
Fixie ecosystem.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.api.AgentError" class="doc doc-heading">
        <code>AgentError</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>An error that occurred in the process of generating a response.</p>


        <details class="quote">
          <summary>Source code in <code>fixieai/agents/api.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pydantic_dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">AgentError</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An error that occurred in the process of generating a response.&quot;&quot;&quot;</span>

    <span class="c1"># A code representing the error.</span>
    <span class="n">code</span><span class="p">:</span> <span class="nb">str</span>

    <span class="c1"># A message describing the error that will be displayed to the user.</span>
    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span>

    <span class="c1"># Additional debugging context from the error.</span>
    <span class="n">details</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.api.AgentQuery" class="doc doc-heading">
        <code>AgentQuery</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>A standalone query sent to a Fixie agent.</p>


        <details class="quote">
          <summary>Source code in <code>fixieai/agents/api.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pydantic_dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">AgentQuery</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A standalone query sent to a Fixie agent.&quot;&quot;&quot;</span>

    <span class="c1"># The contents of the query.</span>
    <span class="n">message</span><span class="p">:</span> <span class="n">Message</span>

    <span class="c1"># This is an access token associated with the user for whom this query was</span>
    <span class="c1"># created. Agents wishing to make queries to other agents, or to other</span>
    <span class="c1"># Fixie services, should carry this token in the query so that it</span>
    <span class="c1"># can be tied back to the original user.</span>
    <span class="n">access_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.api.AgentResponse" class="doc doc-heading">
        <code>AgentResponse</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>A response message from an Agent.</p>


        <details class="quote">
          <summary>Source code in <code>fixieai/agents/api.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pydantic_dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">AgentResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A response message from an Agent.&quot;&quot;&quot;</span>

    <span class="c1"># The text of the response message.</span>
    <span class="n">message</span><span class="p">:</span> <span class="n">Message</span>

    <span class="c1"># Error details, if an error occurred generating the response. Note that `message` should still be included,</span>
    <span class="c1"># but may indicate that an error occurred that prevented the agent from fully handling the request.</span>
    <span class="n">error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AgentError</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.api.Embed" class="doc doc-heading">
        <code>Embed</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>An Embed represents a binary object attached to a Message.</p>


        <details class="quote">
          <summary>Source code in <code>fixieai/agents/api.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pydantic_dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">Embed</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An Embed represents a binary object attached to a Message.&quot;&quot;&quot;</span>

    <span class="c1"># The MIME content type of the object, e.g., &quot;image/png&quot; or &quot;application/json&quot;.</span>
    <span class="n">content_type</span><span class="p">:</span> <span class="nb">str</span>

    <span class="c1"># A public URL where the object can be downloaded. This can be a data URI.</span>
    <span class="n">uri</span><span class="p">:</span> <span class="nb">str</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">content</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves the content for this Embed object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;data:&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span><span class="o">.</span><span class="n">content</span>

    <span class="nd">@content</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the content of the Embed object as a data URI.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uri</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;data:base64,</span><span class="si">{</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves the content of the Embed object as a string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

    <span class="nd">@text</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the content of the Embed object as a string.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="fixieai.agents.api.Embed.content" class="doc doc-heading">
<code class="highlight language-python"><span class="n">content</span><span class="p">:</span> <span class="nb">bytes</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Retrieves the content for this Embed object.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="fixieai.agents.api.Embed.text" class="doc doc-heading">
<code class="highlight language-python"><span class="n">text</span><span class="p">:</span> <span class="nb">str</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Retrieves the content of the Embed object as a string.</p>
  </div>

</div>





  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.api.Message" class="doc doc-heading">
        <code>Message</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>A Message represents a single message sent to a Fixie agent.</p>


        <details class="quote">
          <summary>Source code in <code>fixieai/agents/api.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pydantic_dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">Message</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A Message represents a single message sent to a Fixie agent.&quot;&quot;&quot;</span>

    <span class="c1"># The text of the message.</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span>

    <span class="c1"># A mapping of embed keys to Embed objects.</span>
    <span class="n">embeds</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Embed</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">


<a id="fixieai.agents.code_shot"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.code_shot.CodeShotAgent" class="doc doc-heading">
        <code>CodeShotAgent</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="fixieai.agents.agent_base">agent_base</span>.<span title="fixieai.agents.agent_base.AgentBase">AgentBase</span></code></p>

  
      <p>A CodeShot agent.</p>
<p>To make a CodeShot agent, simply pass a BASE_PROMPT and FEW_SHOTS:</p>
<div class="highlight"><pre><span></span><code><span class="nv">BASE_PROMPT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">&quot;A summary of what this agent does; how it does it; and its</span>
<span class="nv">personality</span><span class="err">&quot;</span>

<span class="err">FEW_SHOTS = &#39;&#39;&#39;</span>
<span class="err">Q: &lt;Sample query that this agent supports&gt;</span>
<span class="err">A: &lt;Desired response for this query&gt;</span>

<span class="err">Q: &lt;Another sample query&gt;</span>
<span class="err">A: &lt;Desired response for this query&gt;</span>
<span class="err">&#39;&#39;&#39;</span>

<span class="err">agent = CodeShotAgent(BASE_PROMPT, FEW_SHOTS)</span>
</code></pre></div>

<p>You can have FEW_SHOTS as a single string of all your few-shots separated by 2 new
lines, or as an explicit list of one few-shot per index.</p>
<p>Your few-shots may reach out to other Agents in the fixie ecosystem by
"Ask Agent[agent_id]: <query to pass>", or reach out to some python functions
by "Ask Func[func_name]: <query to pass>".</p>
<p>There are a series of default runtime <code>Func</code>s provided by the platform available for
your agents to consume. For a full list of default runtime <code>Func</code>s, refer to:
    http://docs.fixie.ai/XXX</p>
<p>You may also need to write your own python functions here to be consumed by your
agent. To make a function accessible by an agent, you'd need to register it by
<code>@agent.register_func</code>. Example:</p>
<div class="highlight"><pre><span></span><code><span class="nv">@agent.register_func</span>
<span class="n">def</span><span class="w"> </span><span class="n">func_name</span><span class="p">(</span><span class="k">query</span><span class="o">:</span><span class="w"> </span><span class="n">fixieai</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ReturnType</span><span class="o">:</span>
<span class="w">    </span><span class="p">...</span>

<span class="p">,</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">ReturnType</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">one</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n n-Quoted">`str`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`fixieai.Message`</span><span class="p">,</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n n-Quoted">`fixie.AgentResponse`</span><span class="p">.</span>
</code></pre></div>

<p>Note that in the above, we are using the decorator <code>@agent.register_func</code> to
register this function with the agent instance we just created.</p>
<p>To check out the default <code>Func</code>s that are provided in Fixie, see:
    http://docs.fixie.ai/XXX</p>


        <details class="quote">
          <summary>Source code in <code>fixieai/agents/code_shot.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CodeShotAgent</span><span class="p">(</span><span class="n">agent_base</span><span class="o">.</span><span class="n">AgentBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A CodeShot agent.</span>

<span class="sd">    To make a CodeShot agent, simply pass a BASE_PROMPT and FEW_SHOTS:</span>

<span class="sd">        BASE_PROMPT = &quot;A summary of what this agent does; how it does it; and its</span>
<span class="sd">        personality&quot;</span>

<span class="sd">        FEW_SHOTS = &#39;&#39;&#39;</span>
<span class="sd">        Q: &lt;Sample query that this agent supports&gt;</span>
<span class="sd">        A: &lt;Desired response for this query&gt;</span>

<span class="sd">        Q: &lt;Another sample query&gt;</span>
<span class="sd">        A: &lt;Desired response for this query&gt;</span>
<span class="sd">        &#39;&#39;&#39;</span>

<span class="sd">        agent = CodeShotAgent(BASE_PROMPT, FEW_SHOTS)</span>

<span class="sd">    You can have FEW_SHOTS as a single string of all your few-shots separated by 2 new</span>
<span class="sd">    lines, or as an explicit list of one few-shot per index.</span>

<span class="sd">    Your few-shots may reach out to other Agents in the fixie ecosystem by</span>
<span class="sd">    &quot;Ask Agent[agent_id]: &lt;query to pass&gt;&quot;, or reach out to some python functions</span>
<span class="sd">    by &quot;Ask Func[func_name]: &lt;query to pass&gt;&quot;.</span>

<span class="sd">    There are a series of default runtime `Func`s provided by the platform available for</span>
<span class="sd">    your agents to consume. For a full list of default runtime `Func`s, refer to:</span>
<span class="sd">        http://docs.fixie.ai/XXX</span>

<span class="sd">    You may also need to write your own python functions here to be consumed by your</span>
<span class="sd">    agent. To make a function accessible by an agent, you&#39;d need to register it by</span>
<span class="sd">    `@agent.register_func`. Example:</span>

<span class="sd">        @agent.register_func</span>
<span class="sd">        def func_name(query: fixieai.Message) -&gt; ReturnType:</span>
<span class="sd">            ...</span>

<span class="sd">        , where ReturnType is one of `str`, `fixieai.Message`, or `fixie.AgentResponse`.</span>

<span class="sd">    Note that in the above, we are using the decorator `@agent.register_func` to</span>
<span class="sd">    register this function with the agent instance we just created.</span>

<span class="sd">    To check out the default `Func`s that are provided in Fixie, see:</span>
<span class="sd">        http://docs.fixie.ai/XXX</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">base_prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">few_shots</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
        <span class="n">corpora</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">corpora</span><span class="o">.</span><span class="n">UrlDocumentCorpus</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">conversational</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">oauth_params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">oauth</span><span class="o">.</span><span class="n">OAuthParams</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">llm_settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">llm_settings</span><span class="o">.</span><span class="n">LlmSettings</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">oauth_params</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">few_shots</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">few_shots</span> <span class="o">=</span> <span class="n">_split_few_shots</span><span class="p">(</span><span class="n">few_shots</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_prompt</span> <span class="o">=</span> <span class="n">base_prompt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">few_shots</span> <span class="o">=</span> <span class="n">few_shots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url_corpora</span> <span class="o">=</span> <span class="n">corpora</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conversational</span> <span class="o">=</span> <span class="n">conversational</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llm_settings</span> <span class="o">=</span> <span class="n">llm_settings</span>

        <span class="n">utils</span><span class="o">.</span><span class="n">strip_prompt_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">corpora</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url_corpora</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_corpora</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="n">custom_corpora</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">corpora</span><span class="o">.</span><span class="n">CustomCorpus</span><span class="p">(</span><span class="n">func_name</span><span class="o">=</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_corpus_funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">url_corpora</span> <span class="o">+</span> <span class="n">custom_corpora</span> <span class="k">if</span> <span class="n">url_corpora</span> <span class="ow">or</span> <span class="n">custom_corpora</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">metadata</span><span class="o">.</span><span class="n">Metadata</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">metadata</span><span class="o">.</span><span class="n">CodeShotAgentMetadata</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_prompt</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">few_shots</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">corpora</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conversational</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">llm_settings</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">validate_code_shot_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">


<a id="fixieai.agents.corpora"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.corpora.CorpusDocument" class="doc doc-heading">
        <code>CorpusDocument</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Some meaningful item of data from a corpus. This could be an HTML page,
a PDF, or a raw string of text (among others). Fixie will handle parsing
and chunking this document so that appropriately sized chunks can be
included in LLM requests.</p>
<p>Note: If custom parsing is desired, agents are free to implement their own
parsing to return documents with text/plain mime_types instead of whatever
they fetch natively. Fixie will not alter text/plain documents prior to
chunking.</p>


        <details class="quote">
          <summary>Source code in <code>fixieai/agents/corpora.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pydantic_dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">CorpusDocument</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Some meaningful item of data from a corpus. This could be an HTML page,</span>
<span class="sd">    a PDF, or a raw string of text (among others). Fixie will handle parsing</span>
<span class="sd">    and chunking this document so that appropriately sized chunks can be</span>
<span class="sd">    included in LLM requests.</span>

<span class="sd">    Note: If custom parsing is desired, agents are free to implement their own</span>
<span class="sd">    parsing to return documents with text/plain mime_types instead of whatever</span>
<span class="sd">    they fetch natively. Fixie will not alter text/plain documents prior to</span>
<span class="sd">    chunking.&quot;&quot;&quot;</span>

    <span class="n">source_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">content</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">dataclasses_json</span><span class="o">.</span><span class="n">config</span><span class="p">(</span>
            <span class="n">encoder</span><span class="o">=</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span>
            <span class="n">decoder</span><span class="o">=</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UTF-8&quot;</span>
    <span class="n">mime_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;text/plain&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.corpora.CorpusPage" class="doc doc-heading">
        <code>CorpusPage</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>A page of CorpusDocuments. In addition to the documents themselves, a
page may include a continuation token for fetching the next page (in the
same partition). Omitting a token implies that this is the last page.</p>


        <details class="quote">
          <summary>Source code in <code>fixieai/agents/corpora.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pydantic_dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">CorpusPage</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A page of CorpusDocuments. In addition to the documents themselves, a</span>
<span class="sd">    page may include a continuation token for fetching the next page (in the</span>
<span class="sd">    same partition). Omitting a token implies that this is the last page.&quot;&quot;&quot;</span>

    <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CorpusDocument</span><span class="p">]</span>
    <span class="n">next_page_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.corpora.CorpusPartition" class="doc doc-heading">
        <code>CorpusPartition</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>An identifier for a subset of a corpus, along with an optional
token to use when loading its first page. Each partition will only be
loaded once during a single crawl. If multiple responses include the same
partition, the token of the first received response will be used.</p>


        <details class="quote">
          <summary>Source code in <code>fixieai/agents/corpora.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pydantic_dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">CorpusPartition</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An identifier for a subset of a corpus, along with an optional</span>
<span class="sd">    token to use when loading its first page. Each partition will only be</span>
<span class="sd">    loaded once during a single crawl. If multiple responses include the same</span>
<span class="sd">    partition, the token of the first received response will be used.&quot;&quot;&quot;</span>

    <span class="n">partition</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">first_page_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.corpora.CorpusRequest" class="doc doc-heading">
        <code>CorpusRequest</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="dataclasses_json.core">dataclasses_json</span>.<span title="dataclasses_json.core.DataClassJsonMixin">DataClassJsonMixin</span></code></p>

  
      <p>A request for some piece of the agent's corpus.</p>
<p>In addition to returning documents, each response may expand the corpus
space in one or both of two dimensions: new partitions and next pages.</p>
<p>Partitions are non-overlapping subsets of a corpus which may be loaded in
parallel by Fixie. A response's new partitions will be ignored if
previously included in another response.</p>
<p>When a response includes a page of documents, that page may indicate that
another page is available in the same partition. Pages are always loaded
serially in order. The partition is completed when a response has a page
with no next_page_token.</p>
<p>Agents will always receive a first request with the default (unnamed)
partition and no page_token. Subsequent requests depend on prior responses
and will always include at least one of those fields.</p>

<p><strong>Examples:</strong></p>
    <p>Simple handful of documents:</p>
<div class="highlight"><pre><span></span><code><span class="nv">When</span><span class="w"> </span><span class="nv">receiving</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">initial</span><span class="w"> </span><span class="nv">request</span>,<span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">agent</span><span class="w"> </span><span class="nv">responds</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">page</span>
<span class="nv">of</span><span class="w"> </span><span class="nv">documents</span>.<span class="w"> </span><span class="nv">This</span><span class="w"> </span><span class="nv">could</span><span class="w"> </span><span class="k">include</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">next_page_token</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">more</span>
<span class="nv">documents</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">single</span><span class="w"> </span><span class="nv">default</span><span class="w"> </span><span class="nv">partition</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">needed</span>.
</code></pre></div>

<p>Web crawl:</p>
<div class="highlight"><pre><span></span><code><span class="nv">Each</span><span class="w"> </span><span class="nv">URL</span><span class="w"> </span><span class="nv">corresponds</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">partition</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">agent</span><span class="w"> </span><span class="nv">never</span><span class="w"> </span><span class="nv">returns</span>
<span class="nv">tokens</span>.<span class="w"> </span><span class="nv">The</span><span class="w"> </span><span class="nv">initial</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="nv">includes</span><span class="w"> </span><span class="nv">partitions</span>,<span class="w"> </span><span class="nv">one</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">each</span>
<span class="nv">root</span><span class="w"> </span><span class="nv">URL</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">crawl</span>.<span class="w"> </span><span class="nv">Each</span><span class="w"> </span><span class="nv">subsequent</span><span class="w"> </span><span class="nv">request</span><span class="w"> </span><span class="nv">includes</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">partition</span>
<span class="ss">(</span><span class="nv">the</span><span class="w"> </span><span class="nv">URL</span><span class="ss">)</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">corresponding</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="nv">contains</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">page</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">a</span>
<span class="nv">single</span><span class="w"> </span><span class="nv">document</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">resource</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">URL</span>.<span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">document</span><span class="w"> </span><span class="nv">links</span>
<span class="nv">to</span><span class="w"> </span><span class="nv">other</span><span class="w"> </span><span class="nv">resources</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">should</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">included</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">corpus</span>,<span class="w"> </span><span class="nv">the</span>
<span class="nv">response</span><span class="w"> </span><span class="nv">also</span><span class="w"> </span><span class="nv">contains</span><span class="w"> </span><span class="nv">those</span><span class="w"> </span><span class="nv">URLs</span><span class="w"> </span><span class="nv">as</span><span class="w"> </span><span class="nv">new</span><span class="w"> </span><span class="nv">partitions</span>.<span class="w"> </span><span class="nv">The</span><span class="w"> </span><span class="nv">process</span>
<span class="nv">repeats</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">partitions</span><span class="w"> </span><span class="k">until</span><span class="w"> </span><span class="nv">there</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">no</span><span class="w"> </span><span class="nv">known</span><span class="w"> </span><span class="nv">incomplete</span>
<span class="nv">partitions</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="k">until</span><span class="w"> </span><span class="nv">crawl</span><span class="w"> </span><span class="nv">limits</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">reached</span>.
</code></pre></div>

<p>Database:</p>
<div class="highlight"><pre><span></span><code><span class="nv">Consider</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">database</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">parent</span><span class="w"> </span><span class="nv">table</span><span class="w"> </span><span class="nv">keyed</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="nv">parent_id</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">an</span>
<span class="nv">interleaved</span><span class="w"> </span><span class="nv">child</span><span class="w"> </span><span class="nv">table</span><span class="w"> </span><span class="nv">keyed</span><span class="w"> </span><span class="nv">by</span><span class="w"> </span><span class="ss">(</span><span class="nv">parent_id</span>,<span class="w"> </span><span class="nv">child_id</span><span class="ss">)</span><span class="w"> </span><span class="nv">whose</span><span class="w"> </span><span class="nv">rows</span>
<span class="nv">correspond</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">corpus</span><span class="w"> </span><span class="nv">documents</span>.<span class="w"> </span><span class="nv">This</span><span class="w"> </span><span class="nv">agent</span><span class="w"> </span><span class="nv">will</span><span class="w"> </span><span class="nv">use</span><span class="w"> </span><span class="nv">tokens</span><span class="w"> </span><span class="nv">that</span>
<span class="nv">encode</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">read</span><span class="w"> </span><span class="nv">timestamp</span><span class="w"> </span><span class="ss">(</span><span class="k">for</span><span class="w"> </span><span class="nv">consistency</span><span class="ss">)</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="nv">offset</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">used</span>
<span class="nv">in</span><span class="w"> </span><span class="nv">combination</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">static</span><span class="w"> </span><span class="nv">page</span><span class="w"> </span><span class="nv">size</span>.

<span class="nv">Upon</span><span class="w"> </span><span class="nv">receiving</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">initial</span><span class="w"> </span><span class="nv">CorpusRequest</span>,<span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">agent</span><span class="w"> </span><span class="nv">chooses</span><span class="w"> </span><span class="nv">a</span>
<span class="nv">commit</span><span class="w"> </span><span class="nv">timestamp</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">use</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">reads</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">returns</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">partition</span><span class="w"> </span><span class="k">for</span>
<span class="nv">each</span><span class="w"> </span><span class="nv">parent_id</span><span class="w"> </span><span class="nv">along</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">first_page_token</span><span class="w"> </span><span class="nv">indicating</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">chosen</span>
<span class="nv">read</span><span class="w"> </span><span class="nv">timestamp</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="nv">offset</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="mi">0</span>.

<span class="k">For</span><span class="w"> </span><span class="nv">each</span><span class="w"> </span><span class="nv">partition</span>,<span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">agent</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="nv">receives</span><span class="w"> </span><span class="nv">requests</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">the</span>
<span class="nv">partition</span><span class="w"> </span><span class="ss">(</span><span class="nv">a</span><span class="w"> </span><span class="nv">parent_id</span><span class="ss">)</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">page</span><span class="w"> </span><span class="nv">token</span><span class="w"> </span><span class="ss">(</span><span class="nv">the</span><span class="w"> </span><span class="nv">read</span><span class="w"> </span><span class="nv">timestamp</span><span class="w"> </span><span class="nv">and</span>
<span class="nv">offest</span><span class="ss">)</span>.<span class="w"> </span><span class="nv">It</span><span class="w"> </span><span class="nv">responds</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">documents</span><span class="w"> </span><span class="nv">corresponding</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="nv">page</span>
<span class="nv">size</span><span class="w"> </span><span class="nv">child</span><span class="w"> </span><span class="nv">rows</span><span class="w"> </span><span class="nv">within</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">given</span><span class="w"> </span><span class="nv">parent</span>.<span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="nv">more</span><span class="w"> </span><span class="nv">children</span><span class="w"> </span><span class="nv">exist</span>,
<span class="nv">the</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="nv">includes</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">next_page_token</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">same</span><span class="w"> </span><span class="nv">read</span>
<span class="nv">timestamp</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="nv">incremented</span><span class="w"> </span><span class="nv">offset</span>.<span class="w"> </span><span class="nv">This</span><span class="w"> </span><span class="nv">repeats</span><span class="w"> </span><span class="k">until</span><span class="w"> </span><span class="nv">there</span><span class="w"> </span><span class="nv">are</span>
<span class="nv">no</span><span class="w"> </span><span class="nv">more</span><span class="w"> </span><span class="nv">children</span>,<span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">which</span><span class="w"> </span><span class="nv">point</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">response</span><span class="w"> </span><span class="nv">has</span><span class="w"> </span><span class="nv">no</span>
<span class="nv">next_page_token</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">partition</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">complete</span>.

<span class="nv">Note</span>:<span class="w"> </span><span class="nv">Including</span><span class="w"> </span><span class="nv">multiple</span><span class="w"> </span><span class="nv">parent_ids</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">each</span><span class="w"> </span><span class="nv">partition</span><span class="w"> </span><span class="nv">would</span><span class="w"> </span><span class="nv">also</span>
<span class="w">    </span><span class="nv">work</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">would</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="nv">effective</span><span class="w"> </span><span class="nv">way</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">limit</span><span class="w"> </span><span class="nv">parallelism</span><span class="w"> </span><span class="k">if</span>
<span class="w">    </span><span class="nv">desired</span>.
</code></pre></div>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Attributes:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b>partition</b>
                  (<code><span title="typing.Optional">Optional</span>[str]</code>)
              –
              <div class="doc-md-description">
                <p>The partition of the corpus that should be read. This will
be empty for the initial request, indicating the default partition.
For subsequent requests, it will either be the name of a partition
returned by a previous request or empty if the default partition
contains multiple pages for this agent.</p>
              </div>
            </li>
            <li>
              <b>page_token</b>
                  (<code><span title="typing.Optional">Optional</span>[str]</code>)
              –
              <div class="doc-md-description">
                <p>A token for paginating results within a corpus partition.
If present, this will be echoed from a previous response.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

        <details class="quote">
          <summary>Source code in <code>fixieai/agents/corpora.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pydantic_dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">CorpusRequest</span><span class="p">(</span><span class="n">dataclasses_json</span><span class="o">.</span><span class="n">DataClassJsonMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A request for some piece of the agent&#39;s corpus.</span>

<span class="sd">    In addition to returning documents, each response may expand the corpus</span>
<span class="sd">    space in one or both of two dimensions: new partitions and next pages.</span>

<span class="sd">    Partitions are non-overlapping subsets of a corpus which may be loaded in</span>
<span class="sd">    parallel by Fixie. A response&#39;s new partitions will be ignored if</span>
<span class="sd">    previously included in another response.</span>

<span class="sd">    When a response includes a page of documents, that page may indicate that</span>
<span class="sd">    another page is available in the same partition. Pages are always loaded</span>
<span class="sd">    serially in order. The partition is completed when a response has a page</span>
<span class="sd">    with no next_page_token.</span>

<span class="sd">    Agents will always receive a first request with the default (unnamed)</span>
<span class="sd">    partition and no page_token. Subsequent requests depend on prior responses</span>
<span class="sd">    and will always include at least one of those fields.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Simple handful of documents:</span>

<span class="sd">            When receiving the initial request, the agent responds with a page</span>
<span class="sd">            of documents. This could include a next_page_token for more</span>
<span class="sd">            documents in the single default partition if needed.</span>

<span class="sd">        Web crawl:</span>

<span class="sd">            Each URL corresponds to a partition and the agent never returns</span>
<span class="sd">            tokens. The initial response only includes partitions, one for each</span>
<span class="sd">            root URL to crawl. Each subsequent request includes the partition</span>
<span class="sd">            (the URL) and the corresponding response contains a page with a</span>
<span class="sd">            single document - the resource at that URL. If the document links</span>
<span class="sd">            to other resources that should be included in the corpus, the</span>
<span class="sd">            response also contains those URLs as new partitions. The process</span>
<span class="sd">            repeats for all partitions until there are no known incomplete</span>
<span class="sd">            partitions or until crawl limits are reached.</span>

<span class="sd">        Database:</span>

<span class="sd">            Consider a database with a parent table keyed by parent_id and an</span>
<span class="sd">            interleaved child table keyed by (parent_id, child_id) whose rows</span>
<span class="sd">            correspond to corpus documents. This agent will use tokens that</span>
<span class="sd">            encode a read timestamp (for consistency) and an offset to be used</span>
<span class="sd">            in combination with a static page size.</span>

<span class="sd">            Upon receiving the initial CorpusRequest, the agent chooses a</span>
<span class="sd">            commit timestamp to use for all reads and returns a partition for</span>
<span class="sd">            each parent_id along with a first_page_token indicating the chosen</span>
<span class="sd">            read timestamp and an offset of 0.</span>

<span class="sd">            For each partition, the agent then receives requests with the</span>
<span class="sd">            partition (a parent_id) and a page token (the read timestamp and</span>
<span class="sd">            offest). It responds with documents corresponding to the next page</span>
<span class="sd">            size child rows within the given parent. If more children exist,</span>
<span class="sd">            the response includes a next_page_token with the same read</span>
<span class="sd">            timestamp and an incremented offset. This repeats until there are</span>
<span class="sd">            no more children, at which point the response has no</span>
<span class="sd">            next_page_token and the partition is complete.</span>

<span class="sd">            Note: Including multiple parent_ids in each partition would also</span>
<span class="sd">                work and would be an effective way to limit parallelism if</span>
<span class="sd">                desired.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        partition: The partition of the corpus that should be read. This will</span>
<span class="sd">            be empty for the initial request, indicating the default partition.</span>
<span class="sd">            For subsequent requests, it will either be the name of a partition</span>
<span class="sd">            returned by a previous request or empty if the default partition</span>
<span class="sd">            contains multiple pages for this agent.</span>
<span class="sd">        page_token: A token for paginating results within a corpus partition.</span>
<span class="sd">            If present, this will be echoed from a previous response.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">partition</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">page_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.corpora.CorpusResponse" class="doc doc-heading">
        <code>CorpusResponse</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="dataclasses_json.core">dataclasses_json</span>.<span title="dataclasses_json.core.DataClassJsonMixin">DataClassJsonMixin</span></code></p>

  
      <p>A response to a CorpusRequest. See CorpusRequest for details.</p>


        <details class="quote">
          <summary>Source code in <code>fixieai/agents/corpora.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pydantic_dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">CorpusResponse</span><span class="p">(</span><span class="n">dataclasses_json</span><span class="o">.</span><span class="n">DataClassJsonMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A response to a CorpusRequest. See CorpusRequest for details.&quot;&quot;&quot;</span>

    <span class="n">partitions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">CorpusPartition</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">page</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CorpusPage</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.corpora.CustomCorpus" class="doc doc-heading">
        <code>CustomCorpus</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>A custom corpus for a Fixie CodeShot Agent. This uses a registered
corpus func to load documents from an arbitrary source.</p>


        <details class="quote">
          <summary>Source code in <code>fixieai/agents/corpora.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pydantic_dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">CustomCorpus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A custom corpus for a Fixie CodeShot Agent. This uses a registered</span>
<span class="sd">    corpus func to load documents from an arbitrary source.&quot;&quot;&quot;</span>

    <span class="n">func_name</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.corpora.DocumentLoader" class="doc doc-heading">
        <code>DocumentLoader</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Deprecated. This doesn't do anything.</p>


        <details class="quote">
          <summary>Source code in <code>fixieai/agents/corpora.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@deprecated</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Use register_corpus_func for custom document loading.&quot;</span><span class="p">)</span>
<span class="nd">@pydantic_dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">DocumentLoader</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Deprecated. This doesn&#39;t do anything.&quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.corpora.UrlDocumentCorpus" class="doc doc-heading">
        <code>UrlDocumentCorpus</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>URL Document corpus for a Fixie CodeShot Agent.</p>


        <details class="quote">
          <summary>Source code in <code>fixieai/agents/corpora.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@pydantic_dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">UrlDocumentCorpus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;URL Document corpus for a Fixie CodeShot Agent.&quot;&quot;&quot;</span>

    <span class="n">urls</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;URLs to load documents from. A trailing wildcard (e.g., https://example.com/*),</span>
<span class="sd">    can be used to load all documents from a site.&quot;&quot;&quot;</span>

    <span class="n">exclude_patterns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A list of wildcard patterns to exclude from crawled URLs (e.g., */no_crawl/*).&quot;&quot;&quot;</span>

    <span class="n">auth_token_func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">loader</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DocumentLoader</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Deprecated.</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="fixieai.agents.corpora.UrlDocumentCorpus.exclude_patterns" class="doc doc-heading">
<code class="highlight language-python"><span class="n">exclude_patterns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>A list of wildcard patterns to exclude from crawled URLs (e.g., <em>/no_crawl/</em>).</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="fixieai.agents.corpora.UrlDocumentCorpus.urls" class="doc doc-heading">
<code class="highlight language-python"><span class="n">urls</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>URLs to load documents from. A trailing wildcard (e.g., https://example.com/*),
can be used to load all documents from a site.</p>
  </div>

</div>





  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">


<a id="fixieai.agents.oauth"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.oauth.OAuthHandler" class="doc doc-heading">
        <code>OAuthHandler</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>OAuthHandler that wraps around a (OAuthParams, query) to authenticate.</p>

<details class="this-client-object-provides-3-main-method" open>
  <summary>This client object provides 3 main method</summary>
  <ul>
<li>credentials: Returns current user's OAuth access token, or None if they are
    not authenticated.</li>
<li>get_authorization_url: Returns a url that the users can click to
    authenticate themselves.</li>
<li>authorize: Exchanges a received access code (from auth redirect callback) for
    an access token. If successful, user's storage is updated.</li>
</ul>
</details>

        <details class="quote">
          <summary>Source code in <code>fixieai/agents/oauth.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">OAuthHandler</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    OAuthHandler that wraps around a (OAuthParams, query) to authenticate.</span>

<span class="sd">    This client object provides 3 main method:</span>
<span class="sd">        * credentials: Returns current user&#39;s OAuth access token, or None if they are</span>
<span class="sd">            not authenticated.</span>
<span class="sd">        * get_authorization_url: Returns a url that the users can click to</span>
<span class="sd">            authenticate themselves.</span>
<span class="sd">        * authorize: Exchanges a received access code (from auth redirect callback) for</span>
<span class="sd">            an access token. If successful, user&#39;s storage is updated.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># OAuth keys reserved in UserStorage</span>
    <span class="n">OAUTH_STATE_KEY</span> <span class="o">=</span> <span class="s2">&quot;_oauth_state&quot;</span>
    <span class="n">OAUTH_TOKEN_KEY</span> <span class="o">=</span> <span class="s2">&quot;_oauth_token&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">oauth_params</span><span class="p">:</span> <span class="n">OAuthParams</span><span class="p">,</span>
        <span class="n">token_claims</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">VerifiedTokenClaims</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span> <span class="o">=</span> <span class="n">user_storage</span><span class="o">.</span><span class="n">UserStorage</span><span class="p">(</span><span class="n">token_claims</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_oauth_params</span> <span class="o">=</span> <span class="n">oauth_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_id</span> <span class="o">=</span> <span class="n">token_claims</span><span class="o">.</span><span class="n">agent_id</span>

    <span class="k">def</span> <span class="nf">get_authorization_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a URL to launch the authorization flow.&quot;&quot;&quot;</span>
        <span class="n">auth_state</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent_id</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;response_type&quot;</span><span class="p">:</span> <span class="s2">&quot;code&quot;</span><span class="p">,</span>
            <span class="s2">&quot;access_type&quot;</span><span class="p">:</span> <span class="s2">&quot;offline&quot;</span><span class="p">,</span>
            <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oauth_params</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
            <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oauth_params</span><span class="o">.</span><span class="n">scopes</span><span class="p">),</span>
            <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">auth_state</span><span class="p">,</span>
            <span class="s2">&quot;redirect_uri&quot;</span><span class="p">:</span> <span class="n">constants</span><span class="o">.</span><span class="n">FIXIE_OAUTH_REDIRECT_URL</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oauth_params</span><span class="o">.</span><span class="n">auth_uri</span> <span class="o">+</span> <span class="s2">&quot;?&quot;</span> <span class="o">+</span> <span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># Store auth_state in UserStorage for validation later.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OAUTH_STATE_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">auth_state</span>
        <span class="k">return</span> <span class="n">url</span>

    <span class="k">def</span> <span class="nf">user_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns current user&#39;s OAuth credentials, or None if not authorized.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">creds_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OAUTH_TOKEN_KEY</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">creds_json</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Value at user_storage[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">OAUTH_TOKEN_KEY</span><span class="si">!r}</span><span class="s2">] is &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;not an OAuthCredentials json: </span><span class="si">{</span><span class="n">creds_json</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OAUTH_TOKEN_KEY</span><span class="p">]</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">creds</span> <span class="o">=</span> <span class="n">_OAuthCredentials</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">creds_json</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">LookupError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Value at user_storage[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">OAUTH_TOKEN_KEY</span><span class="si">!r}</span><span class="s2">] is &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;not a valid _OAuthCredentials json: </span><span class="si">{</span><span class="n">creds_json</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OAUTH_TOKEN_KEY</span><span class="p">]</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">creds</span><span class="o">.</span><span class="n">expired</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Credentials expired at </span><span class="si">{</span><span class="n">creds</span><span class="o">.</span><span class="n">expiry</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">creds</span><span class="o">.</span><span class="n">refresh_token</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No refresh token available&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Refreshing credentials...&quot;</span><span class="p">)</span>
            <span class="n">creds</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oauth_params</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_credentials</span><span class="p">(</span><span class="n">creds</span><span class="p">)</span>  <span class="c1"># Save refreshed token to UserStorage</span>
        <span class="k">return</span> <span class="n">creds</span><span class="o">.</span><span class="n">access_token</span>

    <span class="k">def</span> <span class="nf">authorize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Authorize the received access `code` against the client secret.</span>

<span class="sd">        If successful, the credentials will be saved in user storage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">expected_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OAUTH_STATE_KEY</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="n">expected_state</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unknown state token, expected: </span><span class="si">{</span><span class="n">expected_state</span><span class="si">!r}</span><span class="s2"> actual: </span><span class="si">{</span><span class="n">state</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown state token&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;grant_type&quot;</span><span class="p">:</span> <span class="s2">&quot;authorization_code&quot;</span><span class="p">,</span>
            <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oauth_params</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
            <span class="s2">&quot;client_secret&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oauth_params</span><span class="o">.</span><span class="n">client_secret</span><span class="p">,</span>
            <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span>
            <span class="s2">&quot;redirect_uri&quot;</span><span class="p">:</span> <span class="n">constants</span><span class="o">.</span><span class="n">FIXIE_OAUTH_REDIRECT_URL</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">_send_authorize_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oauth_params</span><span class="o">.</span><span class="n">token_uri</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;OAuth auth request succeeded, lifetime=</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">expires_in</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;refreshable=</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">refresh_token</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">_OAuthCredentials</span><span class="p">(</span>
            <span class="n">response</span><span class="o">.</span><span class="n">access_token</span><span class="p">,</span>
            <span class="n">_get_expiry</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">expires_in</span><span class="p">),</span>
            <span class="n">response</span><span class="o">.</span><span class="n">refresh_token</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_credentials</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_save_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="s2">&quot;_OAuthCredentials&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OAUTH_TOKEN_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="fixieai.agents.oauth.OAuthHandler.authorize" class="doc doc-heading">
<code class="highlight language-python"><span class="n">authorize</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Authorize the received access <code>code</code> against the client secret.</p>
<p>If successful, the credentials will be saved in user storage.</p>

      <details class="quote">
        <summary>Source code in <code>fixieai/agents/oauth.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">authorize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Authorize the received access `code` against the client secret.</span>

<span class="sd">    If successful, the credentials will be saved in user storage.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">expected_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OAUTH_STATE_KEY</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="n">expected_state</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unknown state token, expected: </span><span class="si">{</span><span class="n">expected_state</span><span class="si">!r}</span><span class="s2"> actual: </span><span class="si">{</span><span class="n">state</span><span class="si">!r}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown state token&quot;</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;grant_type&quot;</span><span class="p">:</span> <span class="s2">&quot;authorization_code&quot;</span><span class="p">,</span>
        <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oauth_params</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
        <span class="s2">&quot;client_secret&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oauth_params</span><span class="o">.</span><span class="n">client_secret</span><span class="p">,</span>
        <span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="n">code</span><span class="p">,</span>
        <span class="s2">&quot;redirect_uri&quot;</span><span class="p">:</span> <span class="n">constants</span><span class="o">.</span><span class="n">FIXIE_OAUTH_REDIRECT_URL</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">_send_authorize_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oauth_params</span><span class="o">.</span><span class="n">token_uri</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;OAuth auth request succeeded, lifetime=</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">expires_in</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;refreshable=</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">refresh_token</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">credentials</span> <span class="o">=</span> <span class="n">_OAuthCredentials</span><span class="p">(</span>
        <span class="n">response</span><span class="o">.</span><span class="n">access_token</span><span class="p">,</span>
        <span class="n">_get_expiry</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">expires_in</span><span class="p">),</span>
        <span class="n">response</span><span class="o">.</span><span class="n">refresh_token</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_save_credentials</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="fixieai.agents.oauth.OAuthHandler.get_authorization_url" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_authorization_url</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a URL to launch the authorization flow.</p>

      <details class="quote">
        <summary>Source code in <code>fixieai/agents/oauth.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_authorization_url</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a URL to launch the authorization flow.&quot;&quot;&quot;</span>
    <span class="n">auth_state</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent_id</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;response_type&quot;</span><span class="p">:</span> <span class="s2">&quot;code&quot;</span><span class="p">,</span>
        <span class="s2">&quot;access_type&quot;</span><span class="p">:</span> <span class="s2">&quot;offline&quot;</span><span class="p">,</span>
        <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oauth_params</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
        <span class="s2">&quot;scope&quot;</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oauth_params</span><span class="o">.</span><span class="n">scopes</span><span class="p">),</span>
        <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">auth_state</span><span class="p">,</span>
        <span class="s2">&quot;redirect_uri&quot;</span><span class="p">:</span> <span class="n">constants</span><span class="o">.</span><span class="n">FIXIE_OAUTH_REDIRECT_URL</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oauth_params</span><span class="o">.</span><span class="n">auth_uri</span> <span class="o">+</span> <span class="s2">&quot;?&quot;</span> <span class="o">+</span> <span class="n">parse</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="c1"># Store auth_state in UserStorage for validation later.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OAUTH_STATE_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">auth_state</span>
    <span class="k">return</span> <span class="n">url</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 id="fixieai.agents.oauth.OAuthHandler.user_token" class="doc doc-heading">
<code class="highlight language-python"><span class="n">user_token</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns current user's OAuth credentials, or None if not authorized.</p>

      <details class="quote">
        <summary>Source code in <code>fixieai/agents/oauth.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">user_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns current user&#39;s OAuth credentials, or None if not authorized.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">creds_json</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OAUTH_TOKEN_KEY</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">creds_json</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Value at user_storage[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">OAUTH_TOKEN_KEY</span><span class="si">!r}</span><span class="s2">] is &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;not an OAuthCredentials json: </span><span class="si">{</span><span class="n">creds_json</span><span class="si">!r}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OAUTH_TOKEN_KEY</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">creds</span> <span class="o">=</span> <span class="n">_OAuthCredentials</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">creds_json</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">LookupError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Value at user_storage[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">OAUTH_TOKEN_KEY</span><span class="si">!r}</span><span class="s2">] is &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;not a valid _OAuthCredentials json: </span><span class="si">{</span><span class="n">creds_json</span><span class="si">!r}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OAUTH_TOKEN_KEY</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">creds</span><span class="o">.</span><span class="n">expired</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Credentials expired at </span><span class="si">{</span><span class="n">creds</span><span class="o">.</span><span class="n">expiry</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">creds</span><span class="o">.</span><span class="n">refresh_token</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No refresh token available&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Refreshing credentials...&quot;</span><span class="p">)</span>
        <span class="n">creds</span><span class="o">.</span><span class="n">refresh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oauth_params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_credentials</span><span class="p">(</span><span class="n">creds</span><span class="p">)</span>  <span class="c1"># Save refreshed token to UserStorage</span>
    <span class="k">return</span> <span class="n">creds</span><span class="o">.</span><span class="n">access_token</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.oauth.OAuthParams" class="doc doc-heading">
        <code>OAuthParams</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


  <div class="doc doc-contents ">

  
      <p>Encapsulates OAuth parameters, including secret, auth uri, and the scope.</p>
<p>Agents who want to use OAuth flow, should declare their secrets via this object.</p>


        <details class="quote">
          <summary>Source code in <code>fixieai/agents/oauth.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">OAuthParams</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Encapsulates OAuth parameters, including secret, auth uri, and the scope.</span>

<span class="sd">    Agents who want to use OAuth flow, should declare their secrets via this object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">auth_uri</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">token_uri</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">scopes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_client_secrets_file</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">secrets_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;OAuthParams&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes OAuth from a secrets file, e.g., as obtained from the Google</span>
<span class="sd">        Cloud Console.</span>

<span class="sd">        Args:</span>
<span class="sd">            secrets_path: Path to a json file holding secret values.</span>
<span class="sd">            scopes: A list of scopes that access needs to be requested for.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">secrets_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="n">secrets</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;web&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;installed&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
                <span class="n">secrets</span><span class="p">[</span><span class="s2">&quot;client_id&quot;</span><span class="p">],</span>
                <span class="n">secrets</span><span class="p">[</span><span class="s2">&quot;client_secret&quot;</span><span class="p">],</span>
                <span class="n">secrets</span><span class="p">[</span><span class="s2">&quot;auth_uri&quot;</span><span class="p">],</span>
                <span class="n">secrets</span><span class="p">[</span><span class="s2">&quot;token_uri&quot;</span><span class="p">],</span>
                <span class="n">scopes</span><span class="p">,</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="fixieai.agents.oauth.OAuthParams.from_client_secrets_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_client_secrets_file</span><span class="p">(</span><span class="n">secrets_path</span><span class="p">,</span> <span class="n">scopes</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initializes OAuth from a secrets file, e.g., as obtained from the Google
Cloud Console.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b>secrets_path</b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>Path to a json file holding secret values.</p>
              </div>
            </li>
            <li>
              <b>scopes</b>
                  (<code><span title="typing.List">List</span>[str]</code>)
              –
              <div class="doc-md-description">
                <p>A list of scopes that access needs to be requested for.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
      <details class="quote">
        <summary>Source code in <code>fixieai/agents/oauth.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_client_secrets_file</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">secrets_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">scopes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;OAuthParams&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes OAuth from a secrets file, e.g., as obtained from the Google</span>
<span class="sd">    Cloud Console.</span>

<span class="sd">    Args:</span>
<span class="sd">        secrets_path: Path to a json file holding secret values.</span>
<span class="sd">        scopes: A list of scopes that access needs to be requested for.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">secrets_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">secrets</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;web&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;installed&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">secrets</span><span class="p">[</span><span class="s2">&quot;client_id&quot;</span><span class="p">],</span>
            <span class="n">secrets</span><span class="p">[</span><span class="s2">&quot;client_secret&quot;</span><span class="p">],</span>
            <span class="n">secrets</span><span class="p">[</span><span class="s2">&quot;auth_uri&quot;</span><span class="p">],</span>
            <span class="n">secrets</span><span class="p">[</span><span class="s2">&quot;token_uri&quot;</span><span class="p">],</span>
            <span class="n">scopes</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">


<a id="fixieai.agents.standalone"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.standalone.StandaloneAgent" class="doc doc-heading">
        <code>StandaloneAgent</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="fixieai.agents.agent_base">agent_base</span>.<span title="fixieai.agents.agent_base.AgentBase">AgentBase</span></code></p>

  
      <p>An agent that handles queries directly.</p>
<p>To make a StandaloneAgent, pass a function with the following signature</p>
<p>def handle(query: fixieai.Message) -&gt; ReturnType:
        ...</p>
<p>where ReturnType is one of <code>str</code>, <code>fixieai.Message</code>, or <code>fixie.AgentResponse</code>.</p>


        <details class="quote">
          <summary>Source code in <code>fixieai/agents/standalone.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">StandaloneAgent</span><span class="p">(</span><span class="n">agent_base</span><span class="o">.</span><span class="n">AgentBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An agent that handles queries directly.</span>

<span class="sd">    To make a StandaloneAgent, pass a function with the following signature</span>

<span class="sd">    def handle(query: fixieai.Message) -&gt; ReturnType:</span>
<span class="sd">            ...</span>

<span class="sd">    where ReturnType is one of `str`, `fixieai.Message`, or `fixie.AgentResponse`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">handle_message</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
        <span class="n">sample_queries</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">oauth_params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">oauth</span><span class="o">.</span><span class="n">OAuthParams</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">oauth_params</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handle_message</span><span class="p">,</span> <span class="n">agent_func</span><span class="o">.</span><span class="n">AgentFunc</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_message</span><span class="p">:</span> <span class="n">agent_func</span><span class="o">.</span><span class="n">AgentFunc</span> <span class="o">=</span> <span class="n">handle_message</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_message</span> <span class="o">=</span> <span class="n">agent_func</span><span class="o">.</span><span class="n">AgentQueryFunc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">handle_message</span><span class="p">,</span>
                <span class="n">oauth_params</span><span class="p">,</span>
                <span class="n">default_message_type</span><span class="o">=</span><span class="n">api</span><span class="o">.</span><span class="n">Message</span><span class="p">,</span>
                <span class="n">allow_generator</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sample_queries</span> <span class="o">=</span> <span class="n">sample_queries</span>

    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">metadata</span><span class="o">.</span><span class="n">Metadata</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">metadata</span><span class="o">.</span><span class="n">StandaloneAgentMetadata</span><span class="p">(</span><span class="n">sample_queries</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sample_queries</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">api_router</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">fastapi</span><span class="o">.</span><span class="n">APIRouter</span><span class="p">:</span>
        <span class="n">router</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">api_router</span><span class="p">()</span>
        <span class="n">router</span><span class="o">.</span><span class="n">add_api_route</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serve_query</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">router</span>

    <span class="k">def</span> <span class="nf">_serve_query</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="n">api</span><span class="o">.</span><span class="n">AgentQuery</span><span class="p">,</span>
        <span class="n">credentials</span><span class="p">:</span> <span class="n">fastapi</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">HTTPAuthorizationCredentials</span> <span class="o">=</span> <span class="n">fastapi</span><span class="o">.</span><span class="n">Depends</span><span class="p">(</span>
            <span class="n">fastapi</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">HTTPBearer</span><span class="p">()</span>
        <span class="p">),</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">fastapi</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Verifies the request is a valid request from Fixie, and dispatches it to</span>
<span class="sd">        the previously specified `handle_message` function. Depending on the return</span>
<span class="sd">        value of that function, either a single or a streaming response is returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">token_claims</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_check_credentials</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_message</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">token_claims</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fastapi</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">StreamingResponse</span><span class="p">(</span>
            <span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dataclasses</span><span class="o">.</span><span class="n">asdict</span><span class="p">(</span><span class="n">resp</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">resp</span> <span class="ow">in</span> <span class="n">output</span><span class="p">),</span>
            <span class="n">media_type</span><span class="o">=</span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">


<a id="fixieai.agents.user_storage"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.user_storage.UserStorage" class="doc doc-heading">
        <code>UserStorage</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="typing.MutableMapping">MutableMapping</span>[str, <span title="fixieai.agents.user_storage.UserStorageType">UserStorageType</span>]</code></p>

  
      <p>UserStorage provides a dict-like interface to a user-specific storage.</p>
<p>Usage:</p>
<blockquote>
<blockquote>
<blockquote>
<p>from fixieai.agents import token
storage = UserStorage(token.VerifiedTokenClaims("fake-agent", False, "fake-access-token"))
storage["key"] = "value"
storage["complex-key"] = {"key1": {"key2": [12, False, None, b"binary"]}}
assert len(storage) == 2
assert storage["complex-key"][&quot;key1&quot;]["key2"][-1] == b"binary"</p>
</blockquote>
</blockquote>
</blockquote>


        <details class="quote">
          <summary>Source code in <code>fixieai/agents/user_storage.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">UserStorage</span><span class="p">(</span><span class="n">MutableMapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">UserStorageType</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;UserStorage provides a dict-like interface to a user-specific storage.</span>

<span class="sd">    Usage:</span>
<span class="sd">    &gt;&gt;&gt; from fixieai.agents import token</span>
<span class="sd">    &gt;&gt;&gt; storage = UserStorage(token.VerifiedTokenClaims(&quot;fake-agent&quot;, False, &quot;fake-access-token&quot;))</span>
<span class="sd">    &gt;&gt;&gt; storage[&quot;key&quot;] = &quot;value&quot;</span>
<span class="sd">    &gt;&gt;&gt; storage[&quot;complex-key&quot;] = {&quot;key1&quot;: {&quot;key2&quot;: [12, False, None, b&quot;binary&quot;]}}</span>
<span class="sd">    &gt;&gt;&gt; assert len(storage) == 2</span>
<span class="sd">    &gt;&gt;&gt; assert storage[&quot;complex-key&quot;][&quot;key1&quot;][&quot;key2&quot;][-1] == b&quot;binary&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">token_claims</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">VerifiedTokenClaims</span><span class="p">,</span>
        <span class="n">userstorage_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">FIXIE_USER_STORAGE_URL</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">token_claims</span><span class="o">.</span><span class="n">is_anonymous</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">AgentException</span><span class="p">(</span>
                <span class="n">response_message</span><span class="o">=</span><span class="s2">&quot;I&#39;m sorry, you must login to use this agent.&quot;</span><span class="p">,</span>
                <span class="n">error_code</span><span class="o">=</span><span class="s2">&quot;ERR_USERSTORAGE_REQUIRES_USER&quot;</span><span class="p">,</span>
                <span class="n">error_message</span><span class="o">=</span><span class="s2">&quot;This agent requires user storage, which is not available to anonymous users. Please login or create an account.&quot;</span><span class="p">,</span>
                <span class="n">http_status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_id</span> <span class="o">=</span> <span class="n">token_claims</span><span class="o">.</span><span class="n">agent_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_userstorage_url</span> <span class="o">=</span> <span class="n">userstorage_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">token_claims</span><span class="o">.</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">UserStorageType</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_userstorage_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">to_json</span><span class="p">(</span><span class="n">value</span><span class="p">)})</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UserStorageType</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_userstorage_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">from_json</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_userstorage_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_userstorage_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> not found&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">def</span> <span class="nf">_get_all_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_userstorage_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()]</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_all_keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_all_keys</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="fixieai.agents.user_storage.from_json" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_json</span><span class="p">(</span><span class="n">json_dump</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Deserializes a UserStorageType from a JSON string.</p>

      <details class="quote">
        <summary>Source code in <code>fixieai/agents/user_storage.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_dump</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UserStorageType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Deserializes a UserStorageType from a JSON string.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">from_json_type</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_dump</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="fixieai.agents.user_storage.from_json_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_json_type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Decodes a JsonType to UserStorageType.</p>

      <details class="quote">
        <summary>Source code in <code>fixieai/agents/user_storage.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">from_json_type</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">JsonType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UserStorageType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decodes a JsonType to UserStorageType.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">_is_bytes_encoded_json_dict</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">from_json_type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">from_json_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">obj</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="fixieai.agents.user_storage.to_json" class="doc doc-heading">
<code class="highlight language-python"><span class="n">to_json</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Serialize a UserStorageType to a JSON string.</p>

      <details class="quote">
        <summary>Source code in <code>fixieai/agents/user_storage.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">UserStorageType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Serialize a UserStorageType to a JSON string.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">to_json_type</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="fixieai.agents.user_storage.to_json_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">to_json_type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Encodes a UserStorageType to JsonType.</p>

      <details class="quote">
        <summary>Source code in <code>fixieai/agents/user_storage.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_json_type</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">UserStorageType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JsonType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Encodes a UserStorageType to JsonType.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;_bytes_ascii&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;ASCII&quot;</span><span class="p">)}</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">to_json_type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">to_json_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">obj</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">


<a id="fixieai.agents.utils"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="fixieai.agents.utils.FewshotLinePattern" class="doc doc-heading">
        <code>FewshotLinePattern</code>


</h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code>enum.<span title="enum.Enum">Enum</span></code></p>



        <details class="quote">
          <summary>Source code in <code>fixieai/agents/utils.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FewshotLinePattern</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">QUERY</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^Q:&quot;</span><span class="p">)</span>
    <span class="n">AGENT_SAYS</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^Agent\[(?P&lt;agent_id&gt;\w+)] says:&quot;</span><span class="p">)</span>
    <span class="n">FUNC_SAYS</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^Func\[(?P&lt;func_name&gt;\w+)] says:&quot;</span><span class="p">)</span>
    <span class="n">ASK_AGENT</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^Ask Agent\[(?P&lt;agent_id&gt;\w+)]:&quot;</span><span class="p">)</span>
    <span class="n">ASK_FUNC</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^Ask Func\[(?P&lt;func_name&gt;\w+)]:&quot;</span><span class="p">)</span>
    <span class="n">RESPONSE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^A:&quot;</span><span class="p">)</span>
    <span class="n">NO_PATTERN</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">Match</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a match from a FewshotLinePattern for a given line, or None if nothing matched.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot get the pattern for a multi-line text. Patterns must be &quot;</span>
                <span class="s2">&quot;extracted one line at a time.&quot;</span>
            <span class="p">)</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span>
            <span class="k">match</span>
            <span class="k">for</span> <span class="n">prompt_pattern</span> <span class="ow">in</span> <span class="bp">cls</span>
            <span class="k">if</span> <span class="n">prompt_pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">NO_PATTERN</span>
            <span class="ow">and</span> <span class="p">(</span><span class="n">match</span> <span class="o">:=</span> <span class="n">prompt_pattern</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;More than one pattern (</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">FewshotLinePattern</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">re</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">matches</span><span class="p">)</span><span class="si">}</span><span class="s2">) matched the line </span><span class="si">{</span><span class="n">line</span><span class="si">!r}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">match</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">re</span> <span class="ow">is</span> <span class="bp">cls</span><span class="o">.</span><span class="n">QUERY</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A &#39;Q:&#39; line cannot end without a query.&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Match</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">match</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 id="fixieai.agents.utils.FewshotLinePattern.match" class="doc doc-heading">
<code class="highlight language-python"><span class="k">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a match from a FewshotLinePattern for a given line, or None if nothing matched.</p>

      <details class="quote">
        <summary>Source code in <code>fixieai/agents/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">Match</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a match from a FewshotLinePattern for a given line, or None if nothing matched.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Cannot get the pattern for a multi-line text. Patterns must be &quot;</span>
            <span class="s2">&quot;extracted one line at a time.&quot;</span>
        <span class="p">)</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span>
        <span class="k">match</span>
        <span class="k">for</span> <span class="n">prompt_pattern</span> <span class="ow">in</span> <span class="bp">cls</span>
        <span class="k">if</span> <span class="n">prompt_pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">NO_PATTERN</span>
        <span class="ow">and</span> <span class="p">(</span><span class="n">match</span> <span class="o">:=</span> <span class="n">prompt_pattern</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;More than one pattern (</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">FewshotLinePattern</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">re</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">matches</span><span class="p">)</span><span class="si">}</span><span class="s2">) matched the line </span><span class="si">{</span><span class="n">line</span><span class="si">!r}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">match</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">re</span> <span class="ow">is</span> <span class="bp">cls</span><span class="o">.</span><span class="n">QUERY</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A &#39;Q:&#39; line cannot end without a query.&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Match</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">match</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="fixieai.agents.utils.strip_prompt_lines" class="doc doc-heading">
<code class="highlight language-python"><span class="n">strip_prompt_lines</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Strips all prompt lines.</p>

      <details class="quote">
        <summary>Source code in <code>fixieai/agents/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">strip_prompt_lines</span><span class="p">(</span><span class="n">agent</span><span class="p">:</span> <span class="n">code_shot</span><span class="o">.</span><span class="n">CodeShotAgent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Strips all prompt lines.&quot;&quot;&quot;</span>
    <span class="n">agent</span><span class="o">.</span><span class="n">base_prompt</span> <span class="o">=</span> <span class="n">_strip_all_lines</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">base_prompt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fewshot</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">few_shots</span><span class="p">):</span>
        <span class="n">agent</span><span class="o">.</span><span class="n">few_shots</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_strip_all_lines</span><span class="p">(</span><span class="n">fewshot</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="fixieai.agents.utils.validate_code_shot_agent" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate_code_shot_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>A client-side validation of few_shots and agent.</p>

      <details class="quote">
        <summary>Source code in <code>fixieai/agents/utils.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_code_shot_agent</span><span class="p">(</span><span class="n">agent</span><span class="p">:</span> <span class="n">code_shot</span><span class="o">.</span><span class="n">CodeShotAgent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A client-side validation of few_shots and agent.&quot;&quot;&quot;</span>
    <span class="n">_validate_base_prompt</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">base_prompt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">fewshot</span> <span class="ow">in</span> <span class="n">agent</span><span class="o">.</span><span class="n">few_shots</span><span class="p">:</span>
        <span class="n">_validate_few_shot_prompt</span><span class="p">(</span>
            <span class="n">fewshot</span><span class="p">,</span> <span class="n">agent</span><span class="o">.</span><span class="n">conversational</span><span class="p">,</span> <span class="n">agent</span><span class="o">.</span><span class="n">is_valid_func_name</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../python-client-api/" class="btn btn-neutral float-left" title="Python Client API"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../cli/" class="btn btn-neutral float-right" title="CLI">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright (c) 2023 Fixie.ai, Inc.</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../python-client-api/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../cli/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
